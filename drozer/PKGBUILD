pkgname=drozer
pkgver=2.4.4
pkgrel=1
pkgdesc='Comprehensive security and attack framework for Android'
arch=('x86_64')
url='https://labs.mwrinfosecurity.com/tools/drozer'
license=('bsd')
options=('!strip')
provides=('drozer')

depends=(
    'bash'
    'python2'
    'python2-protobuf'
    'python2-pyopenssl'
    'python2-twisted')
source=("https://github.com/mwrlabs/drozer/releases/download/2.4.4/drozer_2.4.4.deb")
md5sums=('fef0802db020d91eb33a8326da89dee9')

prepare() {
    # Extract out data file 
    tar -xf data.tar.gz
}

package() {
    # Bash completions get installed to a different location on Arch
    mkdir -p "${pkgdir}"/usr/share/bash-completion/completions/
    cp -dr --no-preserve=ownership etc/bash_completion.d/drozer "${pkgdir}"/usr/share/bash-completion/completions/

    # Arch uses python3 by default, so we have to explicitly call python2
    find . -type f -print0 | xargs -0 sed -i 's/\#\!\/usr\/bin\/python/\#\!\/usr\/bin\/python2/'
    
    # Install rest of files
    cp -dr --no-preserve=ownership usr/{bin,share} "${pkgdir}"/usr/

    mkdir -p "${pkgdir}"/usr/lib/python2.7/
    cp -dr --no-preserve=ownership usr/local/lib/python2.7/dist-packages/{drozer,mwr,pydiesel} "${pkgdir}"/usr/lib/python2.7/
}
